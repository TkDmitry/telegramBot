<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1283px" preserveAspectRatio="none" style="width:1701px;height:1283px;" version="1.1" viewBox="0 0 1701 1283" width="1701px" zoomAndPan="magnify"><defs><filter height="300%" id="f1eudmbs61l982" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1eudmbs61l982)" height="175.7969" style="stroke: #000000; stroke-width: 2.0;" width="1136.5" x="543" y="1003.2813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="38" x2="38" y1="86.2969" y2="1196.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="286" x2="286" y1="86.2969" y2="1196.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="616" x2="616" y1="86.2969" y2="1196.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="943.5" x2="943.5" y1="86.2969" y2="1196.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1057.5" x2="1057.5" y1="86.2969" y2="1196.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1172.5" x2="1172.5" y1="86.2969" y2="1196.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1300.5" x2="1300.5" y1="86.2969" y2="1196.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1394.5" x2="1394.5" y1="86.2969" y2="1196.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1622.5" x2="1622.5" y1="86.2969" y2="1196.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="82.9951">Клиент</text><ellipse cx="38.5" cy="13" fill="#FEFECE" filter="url(#f1eudmbs61l982)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,21 L38.5,48 M25.5,29 L51.5,29 M38.5,48 L25.5,63 M38.5,48 L51.5,63 " fill="none" filter="url(#f1eudmbs61l982)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="1208.0732">Клиент</text><ellipse cx="38.5" cy="1221.375" fill="#FEFECE" filter="url(#f1eudmbs61l982)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,1229.375 L38.5,1256.375 M25.5,1237.375 L51.5,1237.375 M38.5,1256.375 L25.5,1271.375 M38.5,1256.375 L51.5,1271.375 " fill="none" filter="url(#f1eudmbs61l982)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="231" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="238" y="70.9951">Telegram Bot</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="231" y="1195.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="238" y="1215.0732">Telegram Bot</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="123" x="553" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="560" y="70.9951">Backend Server</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="123" x="553" y="1195.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="560" y="1215.0732">Backend Server</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="888.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="895.5" y="70.9951">База данных</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="888.5" y="1195.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="895.5" y="1215.0732">База данных</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1008.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1015.5" y="70.9951">ЮKassa API</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1008.5" y="1195.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1015.5" y="1215.0732">ЮKassa API</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="1116.5" y="34.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1123.5" y="54.6982">BaaS Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1123.5" y="70.9951">(A2PAY/Aftab)</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="1116.5" y="1195.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1123.5" y="1215.0732">BaaS Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1123.5" y="1231.3701">(A2PAY/Aftab)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="117" x="1239.5" y="82.9951">Администратор</text><ellipse cx="1301" cy="13" fill="#FEFECE" filter="url(#f1eudmbs61l982)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M1301,21 L1301,48 M1288,29 L1314,29 M1301,48 L1288,63 M1301,48 L1314,63 " fill="none" filter="url(#f1eudmbs61l982)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="117" x="1239.5" y="1208.0732">Администратор</text><ellipse cx="1301" cy="1221.375" fill="#FEFECE" filter="url(#f1eudmbs61l982)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M1301,1229.375 L1301,1256.375 M1288,1237.375 L1314,1237.375 M1301,1256.375 L1288,1271.375 M1301,1256.375 L1314,1271.375 " fill="none" filter="url(#f1eudmbs61l982)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="1372.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="1379.5" y="70.9951">n8n</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="1372.5" y="1195.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="1379.5" y="1215.0732">n8n</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="1576.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1583.5" y="70.9951">Email Bank</text><rect fill="#FEFECE" filter="url(#f1eudmbs61l982)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="1576.5" y="1195.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1583.5" y="1215.0732">Email Bank</text><rect fill="#EEEEEE" filter="url(#f1eudmbs61l982)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1686.5" x="3" y="116.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1689.5" y1="116.8633" y2="116.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1689.5" y1="119.8633" y2="119.8633"/><rect fill="#EEEEEE" filter="url(#f1eudmbs61l982)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="240" x="726.25" y="106.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="221" x="732.25" y="122.3638">Клиент инициирует перевод</text><polygon fill="#A80036" points="274.5,156.5625,284.5,160.5625,274.5,164.5625,278.5,160.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38.5" x2="280.5" y1="160.5625" y2="160.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="45.5" y="155.4966">/transfer &lt;сумма_в_rub&gt;</text><polygon fill="#A80036" points="604.5,185.6953,614.5,189.6953,604.5,193.6953,608.5,189.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="286.5" x2="610.5" y1="189.6953" y2="189.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="293.5" y="184.6294">POST /transfer {user_id, amount_rub}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="658.5" y1="218.8281" y2="218.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="658.5" x2="658.5" y1="218.8281" y2="231.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="617.5" x2="658.5" y1="231.8281" y2="231.8281"/><polygon fill="#A80036" points="627.5,227.8281,617.5,231.8281,627.5,235.8281,623.5,231.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="623.5" y="213.7622">Генерирует ID транзакции</text><polygon fill="#A80036" points="931.5,256.9609,941.5,260.9609,931.5,264.9609,935.5,260.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="937.5" y1="260.9609" y2="260.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="623.5" y="255.895">Сохраняет транзакцию (PENDING)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="658.5" y1="290.0938" y2="290.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="658.5" x2="658.5" y1="290.0938" y2="303.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="617.5" x2="658.5" y1="303.0938" y2="303.0938"/><polygon fill="#A80036" points="627.5,299.0938,617.5,303.0938,627.5,307.0938,623.5,303.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="623.5" y="285.0278">Рассчитывает курс и сумму в EUR</text><polygon fill="#A80036" points="297.5,328.2266,287.5,332.2266,297.5,336.2266,293.5,332.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="291.5" x2="615.5" y1="332.2266" y2="332.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="306" x="303.5" y="327.1606">{transaction_id, amount_eur, payment_details}</text><polygon fill="#A80036" points="49.5,387.625,39.5,391.625,49.5,395.625,45.5,391.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43.5" x2="285.5" y1="391.625" y2="391.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="55.5" y="356.2935">"Переведите &lt;amount_rub&gt; RUB</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="55.5" y="371.4263">Реквизиты: ...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="55.5" y="386.5591">Комментарий: &lt;transaction_id&gt;"</text><rect fill="#EEEEEE" filter="url(#f1eudmbs61l982)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1686.5" x="3" y="420.1914"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1689.5" y1="420.1914" y2="420.1914"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1689.5" y1="423.1914" y2="423.1914"/><rect fill="#EEEEEE" filter="url(#f1eudmbs61l982)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="169" x="761.75" y="409.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="150" x="767.75" y="425.6919">Клиент оплачивает</text><polygon fill="#A80036" points="1045.5,459.8906,1055.5,463.8906,1045.5,467.8906,1049.5,463.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38.5" x2="1051.5" y1="463.8906" y2="463.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="45.5" y="458.8247">Оплата с комментарием &lt;transaction_id&gt;</text><polygon fill="#A80036" points="627.5,489.0234,617.5,493.0234,627.5,497.0234,623.5,493.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="621.5" x2="1056.5" y1="493.0234" y2="493.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="633.5" y="487.9575">Webhook о платеже (автоматически)</text><polygon fill="#A80036" points="931.5,518.1563,941.5,522.1563,931.5,526.1563,935.5,522.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="937.5" y1="522.1563" y2="522.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="623.5" y="517.0903">Обновляет статус транзакции (PAID)</text><rect fill="#EEEEEE" filter="url(#f1eudmbs61l982)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1686.5" x="3" y="550.7227"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1689.5" y1="550.7227" y2="550.7227"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1689.5" y1="553.7227" y2="553.7227"/><rect fill="#EEEEEE" filter="url(#f1eudmbs61l982)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="274" x="709.25" y="540.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="255" x="715.25" y="556.2231">Админ подтверждает получение</text><polygon fill="#A80036" points="627.5,590.4219,617.5,594.4219,627.5,598.4219,623.5,594.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="621.5" x2="1300" y1="594.4219" y2="594.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="633.5" y="589.356">Просматривает список транзакций (ручная проверка)</text><polygon fill="#A80036" points="931.5,619.5547,941.5,623.5547,931.5,627.5547,935.5,623.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="937.5" y1="623.5547" y2="623.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="271" x="623.5" y="618.4888">Получает транзакции со статусом PAID</text><polygon fill="#A80036" points="1289,648.6875,1299,652.6875,1289,656.6875,1293,652.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="1295" y1="652.6875" y2="652.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="623.5" y="647.6216">Список транзакций для обработки</text><polygon fill="#A80036" points="627.5,677.8203,617.5,681.8203,627.5,685.8203,623.5,681.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="621.5" x2="1300" y1="681.8203" y2="681.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="633.5" y="676.7544">Подтверждает транзакцию &lt;transaction_id&gt;</text><polygon fill="#A80036" points="1161,706.9531,1171,710.9531,1161,714.9531,1165,710.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="1167" y1="710.9531" y2="710.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="623.5" y="705.8872">POST /cards/create {user_data}</text><polygon fill="#A80036" points="627.5,736.0859,617.5,740.0859,627.5,744.0859,623.5,740.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="621.5" x2="1172" y1="740.0859" y2="740.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="633.5" y="735.02">{card_id, card_details}</text><polygon fill="#A80036" points="1161,765.2188,1171,769.2188,1161,773.2188,1165,769.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="1167" y1="769.2188" y2="769.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="306" x="623.5" y="764.1528">POST /accounts/transfer {card_id, amount_eur}</text><polygon fill="#A80036" points="931.5,794.3516,941.5,798.3516,931.5,802.3516,935.5,798.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="937.5" y1="798.3516" y2="798.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="623.5" y="793.2856">Обновляет статус транзакции (COMPLETED)</text><rect fill="#EEEEEE" filter="url(#f1eudmbs61l982)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1686.5" x="3" y="826.918"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1689.5" y1="826.918" y2="826.918"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1689.5" y1="829.918" y2="829.918"/><rect fill="#EEEEEE" filter="url(#f1eudmbs61l982)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="191" x="750.75" y="816.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="172" x="756.75" y="832.4185">Уведомление клиента</text><polygon fill="#A80036" points="297.5,866.6172,287.5,870.6172,297.5,874.6172,293.5,870.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="291.5" x2="615.5" y1="870.6172" y2="870.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="303.5" y="865.5513">Уведомление о готовности</text><polygon fill="#A80036" points="49.5,941.1484,39.5,945.1484,49.5,949.1484,45.5,945.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43.5" x2="285.5" y1="945.1484" y2="945.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="55.5" y="894.6841">"Ваша карта готова!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="55.5" y="909.8169">Номер: XXXX-XXXX-XXXX-1234</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="55.5" y="924.9497">Срок: MM/YY</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="55.5" y="940.0825">CVV: 123"</text><rect fill="#EEEEEE" filter="url(#f1eudmbs61l982)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1686.5" x="3" y="973.7148"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1689.5" y1="973.7148" y2="973.7148"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1689.5" y1="976.7148" y2="976.7148"/><rect fill="#EEEEEE" filter="url(#f1eudmbs61l982)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="404" x="644.25" y="963.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="385" x="650.25" y="979.2153">Альтернативный поток: Автоматизация через n8n</text><path d="M543,1003.2813 L803,1003.2813 L803,1010.2813 L793,1020.2813 L543,1020.2813 L543,1003.2813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="175.7969" style="stroke: #000000; stroke-width: 2.0;" width="1136.5" x="543" y="1003.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="558" y="1016.3481">Автоматическая обработка</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="818" y="1015.4917">[Опционально]</text><polygon fill="#A80036" points="1406,1037.5469,1396,1041.5469,1406,1045.5469,1402,1041.5469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1400" x2="1622" y1="1041.5469" y2="1041.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1412" y="1036.481">Новое письмо от банка</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1395" x2="1437" y1="1070.6797" y2="1070.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1437" x2="1437" y1="1070.6797" y2="1083.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1396" x2="1437" y1="1083.6797" y2="1083.6797"/><polygon fill="#A80036" points="1406,1079.6797,1396,1083.6797,1406,1087.6797,1402,1083.6797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="1402" y="1065.6138">Парсит transaction_id из письма</text><polygon fill="#A80036" points="627.5,1108.8125,617.5,1112.8125,627.5,1116.8125,623.5,1112.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="621.5" x2="1394" y1="1112.8125" y2="1112.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="633.5" y="1107.7466">POST /payment/confirm {transaction_id}</text><polygon fill="#A80036" points="931.5,1137.9453,941.5,1141.9453,931.5,1145.9453,935.5,1141.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="937.5" y1="1141.9453" y2="1141.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="623.5" y="1136.8794">Обновляет статус транзакции (PAID)</text><polygon fill="#A80036" points="1383,1167.0781,1393,1171.0781,1383,1175.0781,1387,1171.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616.5" x2="1389" y1="1171.0781" y2="1171.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="623.5" y="1166.0122">200 OK</text><!--MD5=[dcfaec50a9a66060df841167c30abbf8]
@startuml diagram

actor "Клиент" as Client
participant "Telegram Bot" as Bot
participant "Backend Server" as Backend
participant "База данных" as DB
participant "ЮKassa API" as YooMoney
participant "BaaS Provider\n(A2PAY/Aftab)" as BaaS
actor "Администратор" as Admin

== Клиент инициирует перевод ==

Client -> Bot: /transfer <сумма_в_rub>
Bot -> Backend: POST /transfer {user_id, amount_rub}
Backend -> Backend: Генерирует ID транзакции
Backend -> DB: Сохраняет транзакцию (PENDING)
Backend -> Backend: Рассчитывает курс и сумму в EUR
Backend -> Bot: {transaction_id, amount_eur, payment_details}

Bot -> Client: "Переведите <amount_rub> RUB\nРеквизиты: ...\nКомментарий: <transaction_id>"

== Клиент оплачивает ==

Client -> YooMoney: Оплата с комментарием <transaction_id>
YooMoney -> Backend: Webhook о платеже (автоматически)
Backend -> DB: Обновляет статус транзакции (PAID)

== Админ подтверждает получение ==

Admin -> Backend: Просматривает список транзакций (ручная проверка)
Backend -> DB: Получает транзакции со статусом PAID
Backend -> Admin: Список транзакций для обработки

Admin -> Backend: Подтверждает транзакцию <transaction_id>
Backend -> BaaS: POST /cards/create {user_data}
BaaS -> Backend: {card_id, card_details}
Backend -> BaaS: POST /accounts/transfer {card_id, amount_eur}
Backend -> DB: Обновляет статус транзакции (COMPLETED)

== Уведомление клиента ==

Backend -> Bot: Уведомление о готовности
Bot -> Client: "Ваша карта готова! \nНомер: XXXX-XXXX-XXXX-1234\nСрок: MM/YY\nCVV: 123"

== Альтернативный поток: Автоматизация через n8n ==

group Автоматическая обработка [Опционально]
    participant "n8n" as N8N
    participant "Email Bank" as Email
    
    Email -> N8N: Новое письмо от банка
    N8N -> N8N: Парсит transaction_id из письма
    N8N -> Backend: POST /payment/confirm {transaction_id}
    Backend -> DB: Обновляет статус транзакции (PAID)
    Backend -> N8N: 200 OK
end

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 17.0.16+8
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>